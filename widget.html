<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Calendar Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .calendar-widget {
            width: 400px;
            height: 400px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .calendar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(0, 0, 0, 0.3) 0%,
                rgba(0, 0, 0, 0.1) 50%,
                rgba(0, 0, 0, 0.4) 100%
            );
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px 30px;
        }

        .month-year {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        .spacer {
            flex: 1;
        }

        .month {
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .year {
            font-size: 16px;
            font-weight: 200;
            opacity: 0.9;
            margin-top: 5px;
        }

        .current-day-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .current-day {
            font-size: 120px;
            font-weight: 100;
            color: white;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            line-height: 1;
            opacity: 0.65;
        }

        .day-name {
            font-size: 18px;
            font-weight: 300;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
            opacity: 0.65;
        }

        .holiday-display {
            font-size: 12px;
            font-weight: 400;
            color: #ffc107;
            text-align: center;
            margin-top: 8px;
            padding: 4px 8px;
            background-color: rgba(255, 193, 7, 0.1);
            border-radius: 12px;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .widget-info {
            text-align: center;
            color: white;
            font-size: 12px;
            opacity: 0.8;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        /* Responsive design */
        @media (max-width: 480px) {
            .calendar-widget {
                width: 90vmin;
                height: 90vmin;
                max-width: 350px;
                max-height: 350px;
            }

            .current-day {
                font-size: 100px;
            }

            .month {
                font-size: 20px;
            }

            .calendar-overlay {
                padding: 10px 20px;
            }
        }

        @media (max-width: 320px) {
            .current-day {
                font-size: 80px;
            }

            .month {
                font-size: 18px;
            }
        }

        /* Animation for smooth transitions */
        .calendar-widget {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .calendar-widget:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        /* Modal styles for full calendar */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 300;
            margin: 0;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .calendar-header {
            background-color: #667eea;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .calendar-day {
            background-color: white;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .calendar-day:hover {
            background-color: #f0f0f0;
        }

        .calendar-day.selected {
            background-color: #667eea;
            color: white;
        }

        .calendar-day.today {
            background-color: #764ba2;
            color: white;
            font-weight: bold;
        }

        .calendar-day.other-month {
            color: #ccc;
            background-color: #f9f9f9;
        }

        .calendar-day.has-note {
            background-color: #e8f4f8;
        }

        .calendar-day.has-note::after {
            content: '';
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 6px;
            height: 6px;
            background-color: #667eea;
            border-radius: 50%;
        }

        .calendar-day.holiday {
            background-color: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            position: relative;
        }

        .calendar-day.holiday.has-note {
            background: linear-gradient(135deg, #e8f4f8 50%, rgba(255, 193, 7, 0.2) 50%);
            border: 1px solid #667eea;
            box-shadow: 0 0 0 1px #ffc107;
        }

        .holiday-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
            line-height: 1;
            z-index: 1;
        }

        .note-section {
            margin-top: 20px;
        }

        .note-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.2s;
        }

        .note-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .note-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background-color: #5a6fd8;
        }

        .btn-secondary {
            background-color: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #d0d0d0;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .selected-date {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        /* Reminder popup styles */
        .reminder-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: popupSlideIn 0.3s ease;
        }

        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .reminder-popup h3 {
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .reminder-popup p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .reminder-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1999;
        }

        /* Mobile responsiveness for modal */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 2% auto;
                max-height: 95vh;
            }

            .modal-header {
                padding: 15px 20px;
            }

            .modal-title {
                font-size: 20px;
            }

            .modal-body {
                padding: 20px;
            }

            .calendar-day {
                min-height: 50px;
                padding: 10px 5px;
                font-size: 14px;
            }

            .calendar-header {
                padding: 10px 5px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="calendar-widget" id="calendarWidget" onclick="openCalendarModal()">
        <div class="calendar-overlay">
            <div class="month-year">
                <div class="month" id="monthName"></div>
                <div class="year" id="yearNumber"></div>
            </div>
            
            <div class="spacer"></div>
            
            <div class="current-day-container">
                <div class="current-day" id="currentDay"></div>
                <div class="day-name" id="dayName"></div>
                <div class="holiday-display" id="holidayDisplay" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Calendar & Notes</h2>
                <button class="close" onclick="closeCalendarModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calendar-navigation" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="previousMonth()" id="prevBtn">&lt; Previous</button>
                    <h3 id="calendarMonth" style="margin: 0; color: #333;"></h3>
                    <button class="btn btn-secondary" onclick="nextMonth()" id="nextBtn">Next &gt;</button>
                </div>
                
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>
                
                <div class="note-section" id="noteSection" style="display: none;">
                    <div class="selected-date" id="selectedDate"></div>
                    <textarea class="note-input" id="noteInput" placeholder="Write your note here..."></textarea>
                    <div class="note-buttons">
                        <button class="btn btn-primary" onclick="saveNote()" id="saveNoteBtn">Save Note</button>
                        <button class="btn btn-danger" onclick="deleteNote()" id="deleteNoteBtn" style="display: none;">Delete Note</button>
                        <button class="btn btn-secondary" onclick="clearSelection()" id="cancelNoteBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Photos from your online server (replace with your server URLs)
        const monthlyPhotos = {
            0: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/5qpYSK_43Nxynd-vO2LLMCjbnbqUzW3G/yDmfB56mKR9m6TDIPU2y1Qot-OX3I3s2/CMQQO2Vm_97_-Y0jzPgZnBfXe67YcP9n/ra4cnhv5QFY.jpg',      // January
            1: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/mxFobPjR_Z0X8dY5tWaFA81v4KEKiHnJ/O1h5tpAktQeIieQ7-KIJ-7iQZQasQZ4w/ZcQ-XCMFo6_dnGV9l4U7NVD139dscyUk/ipHV_hgwgnyEtZArivgj5NjLLndTOSAN.jpg',     // February
            2: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/1JEM5f1Zuqsq7yOdSDKfKUliUEHgagoz/fzQLZfJvGHJqbaPNhRyxJoLDFYVVhWuE/rXWaR7PQcbNyKaIPNw1-K7RtGtHgxtQR/htpHTVEdghk.jpg',        // March
            3: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/94tb8QgrWB3-otyLvkpBYgXC2ONhv2xh/nM5Ta_ogrTLf_BYxx2ay91Fnp7jfwmvY/Fxoe8PZURagFj7bIdboKLDqpFyRTkFmJ/ayzp-NFlX2U.jpg',        // April
            4: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/Ci8VSWO8rhZlriqlZH9a3qj1bJ_d4vum/pIIvvAPglDfav2j5perGI8NWaDY1apJ8/vaez31WzhY5SodMXIF23u2zcjkPr8kbV/LXqCeFk-QlU.jpg',          // May
            5: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/vcWyYnAkdI3sEIHthZs_2psI86HG3B8w/QaDcfAV0DZTrD8QcVqy56rfeu2CYspS8/VT4I3mp-jM6VwuKmqxNa09aIy0sc1kPT/7YyVPpJCODw.jpg',         // June
            6: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/28kn1x4C2MTygssXGNaPO2be1T6AlpJs/_phTtlgzRvngkTN49JnpCqBzxPJgeE10/lZg7dubqT9AuejYR81vLyytL61XiL1pX/yhbMOE4Vpac.jpg',         // July
            7: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/WCugctS3qrg-awwM4-ODP-Loz89PdoEw/O2KAxPWrklvs7zcx8kgkZ4Of9qPuipZ6/6DpDrw8sc2cxEaXABZQd6zETwjJUJCpl/O6Je6HpkIRk.jpg',       // August
            8: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/v60hQtGvbTaGdIiA8IwZeIRPzEMrZchU/l6L-h1E3DFbCnamNNmqXJQey_YMuEZ65/bRaEHCLj1-RkC1pLROO5BgzorXvQ2_q1/z8iEwQR9eYJJWNBS_01UG51nNB1eMROr.jpg',    // September
            9: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/wb6Dw5LIgXoW9N814jzhqTUnyCxGatu9/v8lJy_96gQZsjBPr7A0Gd4IFlqiXZXO-/veAtAU1mM3gQSXolgwdbFPZ-97McB7HS/eiGk8M7buvo.jpg',      // October
            10: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/4CESxFIXd6ZXOF3JP85R4bz2phQ64dBL/hHKEJWe_wnSymVeSYG0QjQiy4k_24Nco/dYL-EPFEMLdJy4ONrfoT6JO21FVirgVs/UV619kkQRXMnnmd6BNZYxnvRjtJQHFL9.jpg',    // November
            11: 'https://static.wfolio.com/file/AqiFFw_TXMM4LDwoI2TPSYAM1lHVLAGB/F3eUE25SDaDntgqyxSyG-PFN1eviGM2K/7HoXEFNKHX0YpZ--pZJPtAkaJe9_5uc6/uDaCeY_0pmMO6l6VfQ9rjXBWCQB0KIHP/RU59hZ7ZU-syvL51uuJRRGbL67KdldUc/oUdrHfbZaEk6at2CkEDa3SKS9Qn7PFZW.jpg'     // December
        };

        // Fallback photos (demo photos from Unsplash)
        const fallbackPhotos = {
            0: 'https://images.unsplash.com/photo-1548919973-5cef591cdbc9?w=800&h=800&fit=crop', // January
            1: 'https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800&h=800&fit=crop', // February
            2: 'https://images.unsplash.com/photo-1521651201144-634f700b36ef?w=800&h=800&fit=crop', // March
            3: 'https://images.unsplash.com/photo-1524863479829-916d8e77f114?w=800&h=800&fit=crop', // April
            4: 'https://images.unsplash.com/photo-1495107334309-fcf20504a5ab?w=800&h=800&fit=crop', // May
            5: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=800&fit=crop', // June
            6: 'https://images.unsplash.com/photo-1501436513145-30f24e19fcc4?w=800&h=800&fit=crop', // July
            7: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800&h=800&fit=crop', // August
            8: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&h=800&fit=crop', // September
            9: 'https://images.unsplash.com/photo-1445991842772-097fea258e7b?w=800&h=800&fit=crop', // October
            10: 'https://images.unsplash.com/photo-1484589065579-248aad0d8b13?w=800&h=800&fit=crop', // November
            11: 'https://images.unsplash.com/photo-1482938289607-e9573fc25ebb?w=800&h=800&fit=crop'  // December
        };

        // Month and day names with internationalization
        const languages = {
            en: {
                monthNames: ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'],
                dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                ui: {
                    calendarTitle: 'Calendar & Notes',
                    saveNote: 'Save Note',
                    deleteNote: 'Delete Note',
                    cancel: 'Cancel',
                    previous: '< Previous',
                    next: 'Next >',
                    reminderTitle: 'üìÖ Reminder',
                    reminderTomorrow: 'Tomorrow',
                    gotIt: 'Got it!',
                    notePlaceholder: 'Write your note here...',
                    holidayDetected: 'Holiday detected for your country: {country}'
                }
            },
            es: {
                monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                           'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                dayNames: ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'],
                dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'],
                ui: {
                    calendarTitle: 'Calendario y Notas',
                    saveNote: 'Guardar Nota',
                    deleteNote: 'Eliminar Nota',
                    cancel: 'Cancelar',
                    previous: '< Anterior',
                    next: 'Siguiente >',
                    reminderTitle: 'üìÖ Recordatorio',
                    reminderTomorrow: 'Ma√±ana',
                    gotIt: '¬°Entendido!',
                    notePlaceholder: 'Escribe tu nota aqu√≠...',
                    holidayDetected: 'Festividad detectada para tu pa√≠s: {country}'
                }
            },
            fr: {
                monthNames: ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
                           'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'],
                dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
                dayNamesShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
                ui: {
                    calendarTitle: 'Calendrier et Notes',
                    saveNote: 'Enregistrer',
                    deleteNote: 'Supprimer',
                    cancel: 'Annuler',
                    previous: '< Pr√©c√©dent',
                    next: 'Suivant >',
                    reminderTitle: 'üìÖ Rappel',
                    reminderTomorrow: 'Demain',
                    gotIt: 'Compris !',
                    notePlaceholder: '√âcrivez votre note ici...'
                }
            },
            de: {
                monthNames: ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni',
                           'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
                dayNames: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],
                dayNamesShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                ui: {
                    calendarTitle: 'Kalender & Notizen',
                    saveNote: 'Speichern',
                    deleteNote: 'L√∂schen',
                    cancel: 'Abbrechen',
                    previous: '< Zur√ºck',
                    next: 'Weiter >',
                    reminderTitle: 'üìÖ Erinnerung',
                    reminderTomorrow: 'Morgen',
                    gotIt: 'Verstanden!',
                    notePlaceholder: 'Schreiben Sie Ihre Notiz hier...'
                }
            },
            it: {
                monthNames: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno',
                           'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
                dayNames: ['Domenica', 'Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'],
                dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'],
                ui: {
                    calendarTitle: 'Calendario e Note',
                    saveNote: 'Salva Nota',
                    deleteNote: 'Elimina Nota',
                    cancel: 'Annulla',
                    previous: '< Precedente',
                    next: 'Successivo >',
                    reminderTitle: 'üìÖ Promemoria',
                    reminderTomorrow: 'Domani',
                    gotIt: 'Capito!',
                    notePlaceholder: 'Scrivi la tua nota qui...'
                }
            },
            pt: {
                monthNames: ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
                dayNames: ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'],
                dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'],
                ui: {
                    calendarTitle: 'Calend√°rio e Notas',
                    saveNote: 'Salvar Nota',
                    deleteNote: 'Excluir Nota',
                    cancel: 'Cancelar',
                    previous: '< Anterior',
                    next: 'Pr√≥ximo >',
                    reminderTitle: 'üìÖ Lembrete',
                    reminderTomorrow: 'Amanh√£',
                    gotIt: 'Entendi!',
                    notePlaceholder: 'Escreva sua nota aqui...'
                }
            },
            ru: {
                monthNames: ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                           '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'],
                dayNames: ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'],
                dayNamesShort: ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'],
                ui: {
                    calendarTitle: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –ó–∞–º–µ—Ç–∫–∏',
                    saveNote: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
                    deleteNote: '–£–¥–∞–ª–∏—Ç—å',
                    cancel: '–û—Ç–º–µ–Ω–∞',
                    previous: '< –ù–∞–∑–∞–¥',
                    next: '–î–∞–ª–µ–µ >',
                    reminderTitle: 'üìÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ',
                    reminderTomorrow: '–ó–∞–≤—Ç—Ä–∞',
                    gotIt: '–ü–æ–Ω—è—Ç–Ω–æ!',
                    notePlaceholder: '–ù–∞–ø–∏—à–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É –∑–¥–µ—Å—å...'
                }
            },
            zh: {
                monthNames: ['‰∏ÄÊúà', '‰∫åÊúà', '‰∏âÊúà', 'ÂõõÊúà', '‰∫îÊúà', 'ÂÖ≠Êúà',
                           '‰∏ÉÊúà', 'ÂÖ´Êúà', '‰πùÊúà', 'ÂçÅÊúà', 'ÂçÅ‰∏ÄÊúà', 'ÂçÅ‰∫åÊúà'],
                dayNames: ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â', 'ÊòüÊúüÂõõ', 'ÊòüÊúü‰∫î', 'ÊòüÊúüÂÖ≠'],
                dayNamesShort: ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'],
                ui: {
                    calendarTitle: 'Êó•ÂéÜÂíåÁ¨îËÆ∞',
                    saveNote: '‰øùÂ≠òÁ¨îËÆ∞',
                    deleteNote: 'Âà†Èô§Á¨îËÆ∞',
                    cancel: 'ÂèñÊ∂à',
                    previous: '< ‰∏ä‰∏Ä‰∏™',
                    next: '‰∏ã‰∏Ä‰∏™ >',
                    reminderTitle: 'üìÖ ÊèêÈÜí',
                    reminderTomorrow: 'ÊòéÂ§©',
                    gotIt: 'Áü•ÈÅì‰∫ÜÔºÅ',
                    notePlaceholder: 'Âú®ËøôÈáåÂÜô‰∏ãÊÇ®ÁöÑÁ¨îËÆ∞...'
                }
            },
            ja: {
                monthNames: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà',
                           '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'],
                dayNames: ['Êó•ÊõúÊó•', 'ÊúàÊõúÊó•', 'ÁÅ´ÊõúÊó•', 'Ê∞¥ÊõúÊó•', 'Êú®ÊõúÊó•', 'ÈáëÊõúÊó•', 'ÂúüÊõúÊó•'],
                dayNamesShort: ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'],
                ui: {
                    calendarTitle: '„Ç´„É¨„É≥„ÉÄ„Éº„Å®„É°„É¢',
                    saveNote: '„É°„É¢„Çí‰øùÂ≠ò',
                    deleteNote: '„É°„É¢„ÇíÂâäÈô§',
                    cancel: '„Ç≠„É£„É≥„Çª„É´',
                    previous: '< Ââç„Å∏',
                    next: 'Ê¨°„Å∏ >',
                    reminderTitle: 'üìÖ „É™„Éû„Ç§„É≥„ÉÄ„Éº',
                    reminderTomorrow: 'ÊòéÊó•',
                    gotIt: '‰∫ÜËß£ÔºÅ',
                    notePlaceholder: '„Åì„Åì„Å´„É°„É¢„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...'
                }
            },
            ar: {
                monthNames: ['ŸäŸÜÿßŸäÿ±', 'ŸÅÿ®ÿ±ÿßŸäÿ±', 'ŸÖÿßÿ±ÿ≥', 'ÿ£ÿ®ÿ±ŸäŸÑ', 'ŸÖÿßŸäŸà', 'ŸäŸàŸÜŸäŸà',
                           'ŸäŸàŸÑŸäŸà', 'ÿ£ÿ∫ÿ≥ÿ∑ÿ≥', 'ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±', 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±', 'ŸÜŸàŸÅŸÖÿ®ÿ±', 'ÿØŸäÿ≥ŸÖÿ®ÿ±'],
                dayNames: ['ÿßŸÑÿ£ÿ≠ÿØ', 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ', 'ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', 'ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', 'ÿßŸÑÿÆŸÖŸäÿ≥', 'ÿßŸÑÿ¨ŸÖÿπÿ©', 'ÿßŸÑÿ≥ÿ®ÿ™'],
                dayNamesShort: ['ÿ£ÿ≠ÿØ', 'ÿßÿ´ŸÜ', 'ÿ´ŸÑÿß', 'ÿ£ÿ±ÿ®', 'ÿÆŸÖŸä', 'ÿ¨ŸÖÿπ', 'ÿ≥ÿ®ÿ™'],
                ui: {
                    calendarTitle: 'ÿßŸÑÿ™ŸÇŸàŸäŸÖ ŸàÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™',
                    saveNote: 'ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©',
                    deleteNote: 'ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©',
                    cancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
                    previous: '< ÿßŸÑÿ≥ÿßÿ®ŸÇ',
                    next: 'ÿßŸÑÿ™ÿßŸÑŸä >',
                    reminderTitle: 'üìÖ ÿ™ÿ∞ŸÉŸäÿ±',
                    reminderTomorrow: 'ÿ∫ÿØÿßŸã',
                    gotIt: 'ŸÅŸáŸÖÿ™!',
                    notePlaceholder: 'ÿßŸÉÿ™ÿ® ŸÖŸÑÿßÿ≠ÿ∏ÿ™ŸÉ ŸáŸÜÿß...'
                }
            }
        };

        // Holiday and location system
        let userCountry = 'US'; // Default fallback
        let holidays = {};
        let isLoadingHolidays = false;

        // Language detection and setup
        let currentLanguage = 'en';
        let monthNames, dayNames, dayNamesShort, uiTexts;

        function detectLanguage() {
            // Get browser language
            const browserLang = navigator.language || navigator.userLanguage;
            const langCode = browserLang.split('-')[0].toLowerCase();
            
            // Check if we support this language
            if (languages[langCode]) {
                currentLanguage = langCode;
            } else {
                // Fallback to English
                currentLanguage = 'en';
            }
            
            // Load language pack
            loadLanguagePack();
            
            console.log(`Language detected: ${browserLang}, using: ${currentLanguage}`);
        }

        // Detect user's country for holidays
        async function detectUserCountry() {
            try {
                // Try to get country from browser locale first
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.includes('-')) {
                    const countryFromLang = browserLang.split('-')[1].toUpperCase();
                    if (countryFromLang.length === 2) {
                        userCountry = countryFromLang;
                        console.log(`Country detected from locale: ${userCountry}`);
                    }
                }

                // Try IP-based geolocation as backup
                try {
                    const response = await fetch('https://ipapi.co/json/');
                    const data = await response.json();
                    if (data.country_code) {
                        userCountry = data.country_code;
                        console.log(`Country detected from IP: ${userCountry}`);
                    }
                } catch (ipError) {
                    console.log('IP geolocation failed, using locale-based detection');
                }

                // Load holidays for detected country
                await loadCountryHolidays();
                
            } catch (error) {
                console.log('Country detection failed, using default US');
                userCountry = 'US';
                await loadCountryHolidays();
            }
        }

        // Load holidays for the user's country
        async function loadCountryHolidays() {
            if (isLoadingHolidays) return;
            isLoadingHolidays = true;

            try {
                const currentYear = new Date().getFullYear();
                // Using Calendarific API (free tier allows 1000 requests/month)
                // Alternative: use date-holidays npm package or similar
                
                // For demo purposes, I'll include major holidays for common countries
                // In production, you'd want to use a proper holiday API
                holidays = getHolidaysForCountry(userCountry, currentYear);
                
                console.log(`Loaded holidays for ${userCountry}:`, holidays);
                
                // Refresh calendar to show holidays
                if (typeof generateCalendar === 'function') {
                    generateCalendar();
                }
                
            } catch (error) {
                console.error('Failed to load holidays:', error);
                holidays = {};
            } finally {
                isLoadingHolidays = false;
            }
        }

        // Get holidays for specific country (static data for demo)
        function getHolidaysForCountry(countryCode, year) {
            const holidayData = {
                'US': {
                    [`${year}-01-01`]: 'New Year\'s Day',
                    [`${year}-01-15`]: 'Martin Luther King Jr. Day',
                    [`${year}-02-19`]: 'Presidents\' Day',
                    [`${year}-05-27`]: 'Memorial Day',
                    [`${year}-07-04`]: 'Independence Day',
                    [`${year}-09-02`]: 'Labor Day',
                    [`${year}-10-14`]: 'Columbus Day',
                    [`${year}-11-11`]: 'Veterans Day',
                    [`${year}-11-28`]: 'Thanksgiving Day',
                    [`${year}-12-25`]: 'Christmas Day'
                },
                'GB': {
                    [`${year}-01-01`]: 'New Year\'s Day',
                    [`${year}-03-29`]: 'Good Friday',
                    [`${year}-04-01`]: 'Easter Monday',
                    [`${year}-05-06`]: 'Early May Bank Holiday',
                    [`${year}-05-27`]: 'Spring Bank Holiday',
                    [`${year}-08-26`]: 'Summer Bank Holiday',
                    [`${year}-12-25`]: 'Christmas Day',
                    [`${year}-12-26`]: 'Boxing Day'
                },
                'CA': {
                    [`${year}-01-01`]: 'New Year\'s Day',
                    [`${year}-02-19`]: 'Family Day',
                    [`${year}-03-29`]: 'Good Friday',
                    [`${year}-05-20`]: 'Victoria Day',
                    [`${year}-07-01`]: 'Canada Day',
                    [`${year}-08-05`]: 'Civic Holiday',
                    [`${year}-09-02`]: 'Labour Day',
                    [`${year}-10-14`]: 'Thanksgiving Day',
                    [`${year}-11-11`]: 'Remembrance Day',
                    [`${year}-12-25`]: 'Christmas Day',
                    [`${year}-12-26`]: 'Boxing Day'
                },
                'DE': {
                    [`${year}-01-01`]: 'Neujahr',
                    [`${year}-01-06`]: 'Heilige Drei K√∂nige',
                    [`${year}-03-29`]: 'Karfreitag',
                    [`${year}-04-01`]: 'Ostermontag',
                    [`${year}-05-01`]: 'Tag der Arbeit',
                    [`${year}-05-09`]: 'Christi Himmelfahrt',
                    [`${year}-05-20`]: 'Pfingstmontag',
                    [`${year}-05-30`]: 'Fronleichnam',
                    [`${year}-10-03`]: 'Tag der Deutschen Einheit',
                    [`${year}-11-01`]: 'Allerheiligen',
                    [`${year}-12-25`]: 'Weihnachtstag',
                    [`${year}-12-26`]: '2. Weihnachtstag'
                },
                'FR': {
                    [`${year}-01-01`]: 'Jour de l\'An',
                    [`${year}-03-29`]: 'Vendredi Saint',
                    [`${year}-04-01`]: 'Lundi de P√¢ques',
                    [`${year}-05-01`]: 'F√™te du Travail',
                    [`${year}-05-08`]: 'F√™te de la Victoire',
                    [`${year}-05-09`]: 'Ascension',
                    [`${year}-05-20`]: 'Lundi de Pentec√¥te',
                    [`${year}-07-14`]: 'F√™te Nationale',
                    [`${year}-08-15`]: 'Assomption',
                    [`${year}-11-01`]: 'Toussaint',
                    [`${year}-11-11`]: 'Armistice',
                    [`${year}-12-25`]: 'No√´l'
                },
                'ES': {
                    [`${year}-01-01`]: 'A√±o Nuevo',
                    [`${year}-01-06`]: 'Epifan√≠a',
                    [`${year}-03-29`]: 'Viernes Santo',
                    [`${year}-05-01`]: 'D√≠a del Trabajador',
                    [`${year}-08-15`]: 'Asunci√≥n',
                    [`${year}-10-12`]: 'D√≠a de la Hispanidad',
                    [`${year}-11-01`]: 'Todos los Santos',
                    [`${year}-12-06`]: 'D√≠a de la Constituci√≥n',
                    [`${year}-12-08`]: 'Inmaculada Concepci√≥n',
                    [`${year}-12-25`]: 'Navidad'
                },
                'IT': {
                    [`${year}-01-01`]: 'Capodanno',
                    [`${year}-01-06`]: 'Epifania',
                    [`${year}-04-01`]: 'Luned√¨ dell\'Angelo',
                    [`${year}-04-25`]: 'Festa della Liberazione',
                    [`${year}-05-01`]: 'Festa del Lavoro',
                    [`${year}-06-02`]: 'Festa della Repubblica',
                    [`${year}-08-15`]: 'Ferragosto',
                    [`${year}-11-01`]: 'Ognissanti',
                    [`${year}-12-08`]: 'Immacolata Concezione',
                    [`${year}-12-25`]: 'Natale',
                    [`${year}-12-26`]: 'Santo Stefano'
                },
                'RU': {
                    [`${year}-01-01`]: '–ù–æ–≤—ã–π –≥–æ–¥',
                    [`${year}-01-07`]: '–†–æ–∂–¥–µ—Å—Ç–≤–æ',
                    [`${year}-02-23`]: '–î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞',
                    [`${year}-03-08`]: '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –∂–µ–Ω—Å–∫–∏–π –¥–µ–Ω—å',
                    [`${year}-05-01`]: '–ü—Ä–∞–∑–¥–Ω–∏–∫ –í–µ—Å–Ω—ã –∏ –¢—Ä—É–¥–∞',
                    [`${year}-05-09`]: '–î–µ–Ω—å –ü–æ–±–µ–¥—ã',
                    [`${year}-06-12`]: '–î–µ–Ω—å –†–æ—Å—Å–∏–∏',
                    [`${year}-11-04`]: '–î–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞'
                },
                'JP': {
                    [`${year}-01-01`]: 'ÂÖÉÊó•',
                    [`${year}-01-08`]: 'Êàê‰∫∫„ÅÆÊó•',
                    [`${year}-02-11`]: 'Âª∫ÂõΩË®òÂøµ„ÅÆÊó•',
                    [`${year}-02-23`]: 'Â§©ÁöáË™ïÁîüÊó•',
                    [`${year}-03-21`]: 'Êò•ÂàÜ„ÅÆÊó•',
                    [`${year}-04-29`]: 'Êò≠Âíå„ÅÆÊó•',
                    [`${year}-05-03`]: 'ÊÜ≤Ê≥ïË®òÂøµÊó•',
                    [`${year}-05-04`]: '„Åø„Å©„Çä„ÅÆÊó•',
                    [`${year}-05-05`]: '„Åì„Å©„ÇÇ„ÅÆÊó•',
                    [`${year}-07-15`]: 'Êµ∑„ÅÆÊó•',
                    [`${year}-08-11`]: 'Â±±„ÅÆÊó•',
                    [`${year}-09-16`]: 'Êï¨ËÄÅ„ÅÆÊó•',
                    [`${year}-09-23`]: 'ÁßãÂàÜ„ÅÆÊó•',
                    [`${year}-10-14`]: '„Çπ„Éù„Éº„ÉÑ„ÅÆÊó•',
                    [`${year}-11-03`]: 'ÊñáÂåñ„ÅÆÊó•',
                    [`${year}-11-23`]: 'Âã§Âä¥ÊÑüË¨ù„ÅÆÊó•'
                },
                'CN': {
                    [`${year}-01-01`]: 'ÂÖÉÊó¶',
                    [`${year}-02-10`]: 'Êò•ËäÇ',
                    [`${year}-04-04`]: 'Ê∏ÖÊòéËäÇ',
                    [`${year}-05-01`]: 'Âä≥Âä®ËäÇ',
                    [`${year}-06-10`]: 'Á´ØÂçàËäÇ',
                    [`${year}-09-15`]: '‰∏≠ÁßãËäÇ',
                    [`${year}-10-01`]: 'ÂõΩÂ∫ÜËäÇ'
                }
            };

            return holidayData[countryCode] || holidayData['US'];
        }

        function loadLanguagePack() {
            const lang = languages[currentLanguage];
            monthNames = lang.monthNames;
            dayNames = lang.dayNames;
            dayNamesShort = lang.dayNamesShort;
            uiTexts = lang.ui;
            
            // Update HTML lang attribute
            document.documentElement.lang = currentLanguage;
            
            // Update page title
            document.title = `${uiTexts.calendarTitle} - Personal Calendar Widget`;
        }

        function updateUILanguage() {
            // Update modal title
            const modalTitle = document.getElementById('modalTitle');
            if (modalTitle) modalTitle.textContent = uiTexts.calendarTitle;
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            if (prevBtn) prevBtn.textContent = uiTexts.previous;
            
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) nextBtn.textContent = uiTexts.next;
            
            // Update note action buttons
            const saveBtn = document.getElementById('saveNoteBtn');
            if (saveBtn) saveBtn.textContent = uiTexts.saveNote;
            
            const deleteBtn = document.getElementById('deleteNoteBtn');
            if (deleteBtn) deleteBtn.textContent = uiTexts.deleteNote;
            
            const cancelBtn = document.getElementById('cancelNoteBtn');
            if (cancelBtn) cancelBtn.textContent = uiTexts.cancel;
            
            // Update placeholder
            const noteInput = document.getElementById('noteInput');
            if (noteInput) noteInput.placeholder = uiTexts.notePlaceholder;
        }

        // Notes storage
        let notes = JSON.parse(localStorage.getItem('calendarNotes') || '{}');
        let currentModalDate = new Date();
        let selectedDate = null;

        // Save notes to localStorage
        function saveNotesToStorage() {
            localStorage.setItem('calendarNotes', JSON.stringify(notes));
        }

        // Modal functions
        function openCalendarModal() {
            const modal = document.getElementById('calendarModal');
            modal.style.display = 'block';
            currentModalDate = new Date();
            generateCalendar();
            updateUILanguage(); // Update UI text when modal opens
            document.body.style.overflow = 'hidden';
        }

        function closeCalendarModal() {
            const modal = document.getElementById('calendarModal');
            modal.style.display = 'none';
            clearSelection();
            document.body.style.overflow = 'auto';
        }

        function previousMonth() {
            currentModalDate.setMonth(currentModalDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentModalDate.setMonth(currentModalDate.getMonth() + 1);
            generateCalendar();
        }

        function generateCalendar() {
            const year = currentModalDate.getFullYear();
            const month = currentModalDate.getMonth();
            
            // Update month header
            document.getElementById('calendarMonth').textContent = 
                `${monthNames[month]} ${year}`;
            
            // Clear existing calendar
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Add day headers
            dayNamesShort.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                const prevMonthDay = new Date(year, month, 1 - startingDayOfWeek + i);
                emptyDay.textContent = prevMonthDay.getDate();
                grid.appendChild(emptyDay);
            }
            
            // Add days of current month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dayDate = new Date(year, month, day);
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Check if this is today
                if (dayDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Check if this day has notes
                if (notes[dateKey]) {
                    dayElement.classList.add('has-note');
                }
                
                // Check if this day is a holiday
                if (holidays[dateKey]) {
                    dayElement.classList.add('holiday');
                    dayElement.title = holidays[dateKey];
                    
                    // Add holiday indicator
                    const holidayIndicator = document.createElement('div');
                    holidayIndicator.className = 'holiday-indicator';
                    holidayIndicator.textContent = 'üéâ';
                    dayElement.appendChild(holidayIndicator);
                }
                
                // Add click event
                dayElement.onclick = () => selectDate(dayDate, dayElement);
                
                grid.appendChild(dayElement);
            }
            
            // Add days from next month to fill the grid
            const totalCells = grid.children.length;
            const remainingCells = 42 - totalCells; // 6 rows √ó 7 days
            for (let i = 1; i <= remainingCells && totalCells < 42; i++) {
                const nextMonthDay = document.createElement('div');
                nextMonthDay.className = 'calendar-day other-month';
                nextMonthDay.textContent = i;
                grid.appendChild(nextMonthDay);
            }
        }

        function selectDate(date, element) {
            // Clear previous selection
            document.querySelectorAll('.calendar-day.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Select new date
            element.classList.add('selected');
            selectedDate = date;
            
            // Show note section
            const noteSection = document.getElementById('noteSection');
            noteSection.style.display = 'block';
            
            // Update selected date display
            const selectedDateElement = document.getElementById('selectedDate');
            let dateDisplayText = `${dayNames[date.getDay()]}, ${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
            
            // Add holiday information if it's a holiday
            if (holidays[dateKey]) {
                dateDisplayText += ` - üéâ ${holidays[dateKey]}`;
            }
            
            selectedDateElement.textContent = dateDisplayText;
            
            // Load existing note
            const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            const noteInput = document.getElementById('noteInput');
            const deleteBtn = document.getElementById('deleteNoteBtn');
            
            if (notes[dateKey]) {
                noteInput.value = notes[dateKey];
                deleteBtn.style.display = 'inline-block';
            } else {
                noteInput.value = '';
                deleteBtn.style.display = 'none';
            }
            
            noteInput.focus();
        }

        function clearSelection() {
            document.querySelectorAll('.calendar-day.selected').forEach(el => {
                el.classList.remove('selected');
            });
            selectedDate = null;
            document.getElementById('noteSection').style.display = 'none';
        }

        function saveNote() {
            if (!selectedDate) return;
            
            const noteInput = document.getElementById('noteInput');
            const noteText = noteInput.value.trim();
            const dateKey = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth() + 1).padStart(2, '0')}-${String(selectedDate.getDate()).padStart(2, '0')}`;
            
            if (noteText) {
                notes[dateKey] = noteText;
                document.getElementById('deleteNoteBtn').style.display = 'inline-block';
            } else {
                delete notes[dateKey];
                document.getElementById('deleteNoteBtn').style.display = 'none';
            }
            
            saveNotesToStorage();
            generateCalendar(); // Refresh to show note indicator
            
            // Show success feedback
            const saveBtn = document.querySelector('.btn-primary');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saved!';
            saveBtn.style.backgroundColor = '#28a745';
            setTimeout(() => {
                saveBtn.textContent = originalText;
                saveBtn.style.backgroundColor = '#667eea';
            }, 1000);
        }

        function deleteNote() {
            if (!selectedDate) return;
            
            const dateKey = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth() + 1).padStart(2, '0')}-${String(selectedDate.getDate()).padStart(2, '0')}`;
            delete notes[dateKey];
            saveNotesToStorage();
            
            document.getElementById('noteInput').value = '';
            document.getElementById('deleteNoteBtn').style.display = 'none';
            generateCalendar(); // Refresh to remove note indicator
        }

        // Reminder system
        function checkForReminders() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const tomorrowKey = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth() + 1).padStart(2, '0')}-${String(tomorrow.getDate()).padStart(2, '0')}`;
            
            if (notes[tomorrowKey]) {
                showReminder(tomorrow, notes[tomorrowKey]);
            }
        }

        function showReminder(date, note) {
            // Check if reminder was already shown today
            const today = new Date().toDateString();
            const reminderKey = `reminder_${date.toDateString()}`;
            const lastShown = localStorage.getItem(reminderKey);
            
            if (lastShown === today) {
                return; // Already shown today
            }
            
            // Create reminder popup
            const backdrop = document.createElement('div');
            backdrop.className = 'reminder-backdrop';
            
            const popup = document.createElement('div');
            popup.className = 'reminder-popup';
            popup.innerHTML = `
                <h3>üìÖ Reminder</h3>
                <p><strong>Tomorrow (${dayNames[date.getDay()]}, ${monthNames[date.getMonth()]} ${date.getDate()}):</strong></p>
                <p>${note}</p>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="closeReminder(this, '${reminderKey}', '${today}')">Got it!</button>
                </div>
            `;
            
            document.body.appendChild(backdrop);
            document.body.appendChild(popup);
            
            backdrop.onclick = () => closeReminder(backdrop, reminderKey, today);
        }

        function closeReminder(element, reminderKey, today) {
            // Find and remove both backdrop and popup
            const backdrop = document.querySelector('.reminder-backdrop');
            const popup = document.querySelector('.reminder-popup');
            
            if (backdrop) backdrop.remove();
            if (popup) popup.remove();
            
            // Mark as shown
            localStorage.setItem(reminderKey, today);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('calendarModal');
            if (event.target === modal) {
                closeCalendarModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            const modal = document.getElementById('calendarModal');
            if (modal.style.display === 'block') {
                if (event.key === 'Escape') {
                    closeCalendarModal();
                } else if (event.key === 'ArrowLeft') {
                    previousMonth();
                } else if (event.key === 'ArrowRight') {
                    nextMonth();
                } else if (event.key === 'Enter' && event.ctrlKey && selectedDate) {
                    saveNote();
                }
            }
        });

        // Function to check if image exists and load appropriate photo
        function loadPhotoForMonth(month) {
            return new Promise((resolve) => {
                const img = new Image();
                
                // Set crossorigin for server images if needed
                img.crossOrigin = 'anonymous';
                
                img.onload = () => {
                    resolve(monthlyPhotos[month]);
                };
                
                img.onerror = () => {
                    console.warn(`Failed to load photo for month ${month + 1}, using fallback`);
                    // If server photo fails, use fallback
                    resolve(fallbackPhotos[month]);
                };
                
                // Add timeout for slow server responses
                const timeout = setTimeout(() => {
                    img.onload = null;
                    img.onerror = null;
                    console.warn(`Photo loading timeout for month ${month + 1}, using fallback`);
                    resolve(fallbackPhotos[month]);
                }, 10000); // 10 second timeout
                
                img.onload = () => {
                    clearTimeout(timeout);
                    resolve(monthlyPhotos[month]);
                };
                
                img.onerror = () => {
                    clearTimeout(timeout);
                    console.warn(`Failed to load photo for month ${month + 1}, using fallback`);
                    resolve(fallbackPhotos[month]);
                };
                
                // Try to load the server photo
                img.src = monthlyPhotos[month];
            });
        }

        async function updateCalendar() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const currentDay = now.getDate();
            const currentDayName = dayNames[now.getDay()];

            // Update text content
            document.getElementById('monthName').textContent = monthNames[currentMonth];
            document.getElementById('yearNumber').textContent = currentYear;
            document.getElementById('currentDay').textContent = currentDay;
            document.getElementById('dayName').textContent = currentDayName;

            // Check for today's holiday
            const todayKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(currentDay).padStart(2, '0')}`;
            const holidayDisplay = document.getElementById('holidayDisplay');
            
            if (holidays[todayKey]) {
                holidayDisplay.textContent = `üéâ ${holidays[todayKey]}`;
                holidayDisplay.style.display = 'block';
            } else {
                holidayDisplay.style.display = 'none';
            }

            // Load and set background image for current month
            const widget = document.getElementById('calendarWidget');
            widget.classList.add('loading');
            
            try {
                const photoUrl = await loadPhotoForMonth(currentMonth);
                widget.style.backgroundImage = `url('${photoUrl}')`;
            } catch (error) {
                console.error('Error loading photo:', error);
                // Use a gradient fallback if all else fails
                widget.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            } finally {
                widget.classList.remove('loading');
            }
        }

        // Update calendar immediately
        detectLanguage(); // Initialize language detection first
        detectUserCountry(); // Initialize country detection and holidays
        updateCalendar();

        // Check for reminders on page load
        setTimeout(checkForReminders, 2000); // Wait 2 seconds after page load

        // Update calendar every minute to catch day changes
        setInterval(updateCalendar, 60000);

        // Check for reminders every hour
        setInterval(checkForReminders, 60 * 60 * 1000);

        // Update calendar at midnight
        function scheduleNextUpdate() {
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            const msUntilMidnight = midnight.getTime() - now.getTime();
            
            setTimeout(() => {
                updateCalendar();
                checkForReminders(); // Check reminders at midnight too
                // Schedule daily updates
                setInterval(updateCalendar, 24 * 60 * 60 * 1000);
            }, msUntilMidnight);
        }

        scheduleNextUpdate();
    </script>
</body>
</html>